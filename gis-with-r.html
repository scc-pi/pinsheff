<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 17 GIS with R | pinsheff</title>
<meta name="author" content="Laurie Platt">
<meta name="description" content="As a rule of thumb, use GIS with R if you’re familiar with R but not ArcGIS and Python, and your project has just some spatial content. If your project is predominantly spatial, you should...">
<meta name="generator" content="bookdown 0.33 with bs4_book()">
<meta property="og:title" content="Chapter 17 GIS with R | pinsheff">
<meta property="og:type" content="book">
<meta property="og:description" content="As a rule of thumb, use GIS with R if you’re familiar with R but not ArcGIS and Python, and your project has just some spatial content. If your project is predominantly spatial, you should...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 17 GIS with R | pinsheff">
<meta name="twitter:description" content="As a rule of thumb, use GIS with R if you’re familiar with R but not ArcGIS and Python, and your project has just some spatial content. If your project is predominantly spatial, you should...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.2/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script><link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="libs/HomeButton-0.0.1/home-button.js"></script><script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script><script src="libs/clipboard-0.0.1/setClipboardText.js"></script><link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">pinsheff</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About</a></li>
<li class="book-part">Power BI</li>
<li><a class="" href="power-bi-fundamentals.html"><span class="header-section-number">1</span> Power BI fundamentals</a></li>
<li><a class="" href="dax.html"><span class="header-section-number">2</span> DAX</a></li>
<li class="book-part">Scripting</li>
<li><a class="" href="why-script.html"><span class="header-section-number">3</span> Why script?</a></li>
<li><a class="" href="r.html"><span class="header-section-number">4</span> R &amp; RStudio</a></li>
<li><a class="" href="rmd.html"><span class="header-section-number">5</span> Markdown</a></li>
<li><a class="" href="python.html"><span class="header-section-number">6</span> Python</a></li>
<li><a class="" href="functions-packages.html"><span class="header-section-number">7</span> Functions &amp; packages</a></li>
<li><a class="" href="github.html"><span class="header-section-number">8</span> Version control &amp; GitHub</a></li>
<li><a class="" href="rap.html"><span class="header-section-number">9</span> RAP</a></li>
<li class="book-part">Accessing data</li>
<li><a class="" href="databases.html"><span class="header-section-number">10</span> Council data</a></li>
<li><a class="" href="warehouse.html"><span class="header-section-number">11</span> Databases, warehouses &amp; lakes</a></li>
<li><a class="" href="api.html"><span class="header-section-number">12</span> APIs</a></li>
<li><a class="" href="public-data.html"><span class="header-section-number">13</span> External data sources</a></li>
<li class="book-part">Spatial data</li>
<li><a class="" href="spatial-data-sources.html"><span class="header-section-number">14</span> Spatial data sources</a></li>
<li><a class="" href="gis-with-web-desktop-tools.html"><span class="header-section-number">15</span> GIS with web &amp; desktop tools</a></li>
<li><a class="" href="gis-with-python.html"><span class="header-section-number">16</span> GIS with Python</a></li>
<li><a class="active" href="gis-with-r.html"><span class="header-section-number">17</span> GIS with R</a></li>
<li><a class="" href="geocoding.html"><span class="header-section-number">18</span> Postcodes &amp; addresses</a></li>
<li class="book-part">ETL</li>
<li class="book-part">Statistical modelling</li>
<li class="book-part">Visualisation</li>
<li class="book-part">Appendix</li>
<li><a class="" href="other.html"><span class="header-section-number">19</span> Other</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/scc-pi/notes">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="gis-with-r" class="section level1">
<h1>
<span class="header-section-number">17</span> GIS with R<a class="anchor" aria-label="anchor" href="#gis-with-r"><i class="fas fa-link"></i></a>
</h1>
<p>As a rule of thumb, use GIS with R if you’re familiar with R but not ArcGIS and Python, <strong>and</strong> your project has just <strong>some</strong> spatial content. If your project is predominantly spatial, you should consider upskilling to ArcGIS. The GIS capabilities of R packages are increasingly competent. However, you’ll be swimming against the tide if you don’t take advantage of the Council’s investment in the ArcGIS platform, tools and skills.</p>
<p>This chapter focusses on how you can include spatial data in your R project from public data sources and the Council’s ArcGIS platform.</p>
<div id="features" class="section level2">
<h2>
<span class="header-section-number">17.1</span> Features<a class="anchor" aria-label="anchor" href="#features"><i class="fas fa-link"></i></a>
</h2>
<p>The term “feature” is useful to distinguish a record as “spatial”. By “spatial” we mean it has a point, a line or a polygon. A point is a pair of coordinates, a line a minimum of two pairs of coordinates and polygons at least three pairs.</p>
<p>Something to keep an eye out for is MULTIPOINT, multi-part polygons etc. This is a single record, a single feature, but it has more than one point, line or polygon. For example, Sheffield secondary school features might be MULTIPOINT so that the feature for King Edward VII school can have one point for the Lower School near Crosspool, and another point for the Upper School in Broomhill.</p>
<div id="simple-features" class="section level3">
<h3>
<span class="header-section-number">17.1.1</span> Simple features<a class="anchor" aria-label="anchor" href="#simple-features"><i class="fas fa-link"></i></a>
</h3>
<p>Simple features is an open standard developed by the Open Geospatial Consortium. It is a hierarchical data model that represents a wide range of geometry types, all of which are supported by the <a href="https://r-spatial.github.io/sf/index.html">sf R package</a>. The <code>sf</code> package also plays nice with the <code>tidyverse</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a data frame with some example records </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">name</span>,    <span class="op">~</span><span class="va">postcode</span>, <span class="op">~</span><span class="va">longitude</span>,  <span class="op">~</span><span class="va">latitude</span>,</span>
<span>  <span class="st">"SCC"</span>,    <span class="st">"S1 2HH"</span>,    <span class="op">-</span><span class="fl">1.470006</span>,   <span class="fl">53.38038</span>,</span>
<span>  <span class="st">"Blades"</span>, <span class="st">"S2 4SU"</span>,  <span class="op">-</span><span class="fl">1.470512</span>,   <span class="fl">53.36986</span>,</span>
<span>  <span class="st">"Owls"</span>,   <span class="st">"S6 1SW"</span>,    <span class="op">-</span><span class="fl">1.500859</span>,   <span class="fl">53.41084</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create simple features</span></span>
<span><span class="va">sf_shef</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">df</span>, </span>
<span>                        coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, <span class="co">#from postcodes.io</span></span>
<span>                        crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="co">#WSG84</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">mapview</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html">mapview</a></span><span class="op">(</span><span class="va">sf_shef</span>, layer.name <span class="op">=</span> <span class="st">"Sheffield institutions"</span><span class="op">)</span></span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-376baed3b958b368d0ff" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-376baed3b958b368d0ff">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[[53.38038,53.36986,53.41084],[-1.470006,-1.470512,-1.500859],6,null,"Sheffield institutions",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0.6},null,null,["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>SCC&emsp;<\/td><\/tr><tr><td>2<\/td><th>postcode&emsp;<\/th><td>S1 2HH&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Blades&emsp;<\/td><\/tr><tr><td>2<\/td><th>postcode&emsp;<\/th><td>S2 4SU&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Owls&emsp;<\/td><\/tr><tr><td>2<\/td><th>postcode&emsp;<\/th><td>S6 1SW&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1","2","3"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-1.500859,53.36986,-1.470006,53.41084,true,"Sheffield institutions","Zoom to Sheffield institutions","<strong> Sheffield institutions <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"Sheffield institutions",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#6666FF"],"labels":["Sheffield institutions"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"Sheffield institutions"}]}],"limits":{"lat":[53.36986,53.41084],"lng":[-1.500859,-1.470006]},"fitBounds":[53.36986,-1.500859,53.41084,-1.470006,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
<div id="coordinates-projections" class="section level2">
<h2>
<span class="header-section-number">17.2</span> Coordinates &amp; projections<a class="anchor" aria-label="anchor" href="#coordinates-projections"><i class="fas fa-link"></i></a>
</h2>
<p>The minimum you need to know is that any spatial data you use is likely to involve one or more of three coordinate systems:</p>
<ol style="list-style-type: decimal">
<li>WSG84 with an ESPG of 4326</li>
<li>Web Mercator with an EPSG of 3857</li>
<li>OSGB1936 (British National Grid) with an ESPG of 27700</li>
</ol>
<p>Most web maps are based on features stored as WSG84 and displayed (projected) as Web Mercator. Postcodes.io uses WSG84, but the Council’s Portal and AGOL, and the ONS Open Geography Portal use OSGB1936 (BNG).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check the coordinate system of simple features</span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">sf_shef</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Coordinate Reference System:
##   User input: EPSG:4326 
##   wkt:
## GEOGCRS["WGS 84",
##     ENSEMBLE["World Geodetic System 1984 ensemble",
##         MEMBER["World Geodetic System 1984 (Transit)"],
##         MEMBER["World Geodetic System 1984 (G730)"],
##         MEMBER["World Geodetic System 1984 (G873)"],
##         MEMBER["World Geodetic System 1984 (G1150)"],
##         MEMBER["World Geodetic System 1984 (G1674)"],
##         MEMBER["World Geodetic System 1984 (G1762)"],
##         MEMBER["World Geodetic System 1984 (G2139)"],
##         ELLIPSOID["WGS 84",6378137,298.257223563,
##             LENGTHUNIT["metre",1]],
##         ENSEMBLEACCURACY[2.0]],
##     PRIMEM["Greenwich",0,
##         ANGLEUNIT["degree",0.0174532925199433]],
##     CS[ellipsoidal,2],
##         AXIS["geodetic latitude (Lat)",north,
##             ORDER[1],
##             ANGLEUNIT["degree",0.0174532925199433]],
##         AXIS["geodetic longitude (Lon)",east,
##             ORDER[2],
##             ANGLEUNIT["degree",0.0174532925199433]],
##     USAGE[
##         SCOPE["Horizontal component of 3D system."],
##         AREA["World."],
##         BBOX[-90,-180,90,180]],
##     ID["EPSG",4326]]</code></pre>
<div id="geographic-projected-coordinate-systems" class="section level3">
<h3>
<span class="header-section-number">17.2.1</span> Geographic &amp; projected coordinate systems<a class="anchor" aria-label="anchor" href="#geographic-projected-coordinate-systems"><i class="fas fa-link"></i></a>
</h3>
<p>A reference ellipsoid as an approximation of the surface of the earth and provides a shape on which a coordinate system can be placed.</p>
<p><strong>Geographic coordinate systems</strong> use the ellipsoid to define specific locations on the surface to create a grid. Datums are geographic coordinate systems based on a specific ellipsoid (so a more specific geographic coordinate system), with an origin at a specific location, and the ellipsoid at a specific orientation. These are also called “spatial reference systems” or “coordinate reference systems”.</p>
<p><strong>Projected coordinate systems</strong> are like geographic coordinate systems. A projected coordinate system is also a grid used as a reference for locations on the planet, but it’s a translation of the three-dimensional grid onto a two-dimensional plane such as a paper map or screen.</p>
<blockquote>
<p>A GCS defines <strong><em>where</em></strong> the data is located on the earth’s surface. A PCS tells the data <strong><em>how</em></strong> to draw on a flat surface such as a screen.</p>
</blockquote>
<p>Coordinate systems, projected and geographic, are often identified by an <a href="https://epsg.org/home.html">EPSG code</a>.</p>
</div>
</div>
<div id="arcgisr" class="section level2">
<h2>
<span class="header-section-number">17.3</span> ArcGIS R &amp; Python packages<a class="anchor" aria-label="anchor" href="#arcgisr"><i class="fas fa-link"></i></a>
</h2>
<p>Listed below are R and Python packages that allow us to leverage ArcGIS functionality. Generally speaking, they are in descending order of ease of use, and the scope of functionality is in ascending order.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Package</th>
<th>Language</th>
<th>ArcGIS Desktop Install Required</th>
<th>Scope</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>esri2sf</code></td>
<td>R</td>
<td>✕</td>
<td>Read from AGOL &amp; ArcGIS Enterprise</td>
</tr>
<tr class="even">
<td><code>arcgisbinding</code></td>
<td>R</td>
<td>✓</td>
<td>Read &amp; write from AGOL &amp; ArcGIS Enterprise</td>
</tr>
<tr class="odd">
<td><code>arcgis</code></td>
<td>Python</td>
<td>✓</td>
<td>Access AGOL &amp; ArcGIS Enterprise functionality</td>
</tr>
<tr class="even">
<td><code>arcpy</code></td>
<td>Python</td>
<td>✓</td>
<td>Access ArcGIS Desktop or Pro functionality</td>
</tr>
</tbody>
</table></div>
<div id="esri2sf" class="section level3">
<h3>
<span class="header-section-number">17.3.1</span> esri2sf<a class="anchor" aria-label="anchor" href="#esri2sf"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>esri2sf</code> R package is the only one of the four packages listed above that is not maintained by ESRI. It is the simplest to start using because it doesn’t require an installation and license for ArcGIS Desktop or Pro. The flip side, is that it has the least amount of functionality and the code isn’t as robust. The scope of the package is limited to reading simple features or data frames from AGOL &amp; ArcGIS Enterprise (ours or other organisation’s).</p>
<p>The <a href="https://geoportal.statistics.gov.uk/">ONS Open Geography Portal</a> is based on the same ArcGIS web tools as our Portal and AGOL. To get, for example, the local authority boundary for Sheffield you first need to navigate to the <a href="https://geoportal.statistics.gov.uk/datasets/local-authority-districts-december-2020-uk-bgc?geometry=-45.896%2C51.101%2C41.028%2C59.782">dataset</a> on the website and get the GeoService API URL:</p>
<div class="inline-figure"><img src="images/open-geog-api.png" width="407"></div>
<p>Then, using:</p>
<ol style="list-style-type: decimal">
<li>
<p>the copied GeoService URL,</p>
<blockquote>
<p><a href="https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/Local_Authority_Districts_December_2020_UK_BGC/FeatureServer/0/query?outFields=*&amp;where=1%3D1" class="uri">https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/Local_Authority_Districts_December_2020_UK_BGC/FeatureServer/0/query?outFields=\\\\\\\*&amp;where=1%3D1</a></p>
</blockquote>
</li>
<li>
<p>some resources to understand how to query the API,</p>
<blockquote>
<p><a href="https://developers.arcgis.com/rest/services-reference/query-feature-service-layer-.htm">ArcGIS REST API - Query (Feature Service/Layer)</a></p>
<p><a href="https://ronsavage.github.io/SQL/sql-92.bnf.html">SQL 92</a> is used by ESRI based APIs</p>
<p><a href="https://www.w3schools.com/tags/ref_urlencode.ASP">HTML encoding</a> is used for building URL queries</p>
</blockquote>
</li>
<li><p>and <code>esri2sf</code>,</p></li>
</ol>
<p>we can get the Sheffield boundary as a simple feature:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Base URL for ONS Open Geography Portal</span></span>
<span><span class="va">ons_geog_base_url</span> <span class="op">&lt;-</span> <span class="st">"https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/"</span></span>
<span></span>
<span><span class="co"># URL part for how detailed the local authority boundary should be</span></span>
<span><span class="va">generalised</span> <span class="op">&lt;-</span> <span class="st">"Local_Authority_Districts_December_2020_UK_BGC"</span></span>
<span></span>
<span><span class="co"># Get Sheffield MSOA boundaries as simple features  </span></span>
<span><span class="va">shef_msoa</span> <span class="op">&lt;-</span> <span class="fu">esri2sf</span><span class="fu">::</span><span class="fu">esri2sf</span><span class="op">(</span>url <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">ons_geog_base_url</span>,</span>
<span>                                                   <span class="va">generalised</span>,</span>
<span>                                                   <span class="st">"/FeatureServer/0"</span><span class="op">)</span>,</span>
<span>                              where <span class="op">=</span> <span class="st">"LAD20NM LIKE 'Sheffield%'"</span>,</span>
<span>                              geomType <span class="op">=</span> <span class="st">"esriGeometryPolygon"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">mapview</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html">mapview</a></span><span class="op">(</span><span class="va">shef_msoa</span>, layer.name <span class="op">=</span> <span class="st">"Sheffield"</span><span class="op">)</span></span></code></pre></div>
<p>The example above reads open data. However, most of the Council’s spatial data on Portal and AGOL requires login credentials to access. Nevertheless, Portal and AGOL login credentials are a smaller requirement than a ArcGIS Desktop or Pro installation and license.</p>
<p><em>TODO - test and note authentication with token</em></p>
<p>Our public <a href="https://github.com/scc-pi/functions">github.com/scc-pi/functions</a> repository includes functions in <code>ShefAreas.R</code> that use <code>esri2sf</code>. The sub-headings immediately below outline how other ArcGIS packages are more powerful, but also more onerous in terms of licensing and setup. So where possible, the intention is to utilise <code>esri2sf</code> in preference to the other ArcGIS packages.</p>
<p>Further information on the <code>esri2sf</code> package, how to install and use it, is available from <a href="https://github.com/yonghah/esri2sf">github.com/yonghah/esri2sf</a>.</p>
</div>
<div id="r-arcgis-bridge" class="section level3">
<h3>
<span class="header-section-number">17.3.2</span> R-ArcGIS Bridge<a class="anchor" aria-label="anchor" href="#r-arcgis-bridge"><i class="fas fa-link"></i></a>
</h3>
<p>The R-ArcGIS Bridge is the name for the <code>arcgisbinding</code> R package. It’s scope is limited to:</p>
<ul>
<li><p>Transferring data in both directions between ArcGIS and R</p></li>
<li><p>Wrapping R tools for use in ArcGIS</p></li>
</ul>
<p>For more information on using the <code>arcgisbinding</code> package see the vignette on <a href="https://r.esri.com/assets/arcgisbinding-vignette.html">Using the R-ArcGIS Bridge</a>.</p>
<p>To use the R-ArcGIS Bridge you need an installation and license for ArcGIS Desktop or Pro. After loading the <code>arcgisbinding</code> package you have to call <code>arc.check_product()</code> to define a desktop license:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">arcgisbinding</span><span class="op">)</span></span>
<span><span class="fu">arc.check_product</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Using <code>arcgisbinding</code> with ArcGIS Desktop means that you need to use 32-bit R, because ArcGIS Desktop is 32-bit. An ArcGIS Desktop 64-bit Background Geoprocessing option is a red herring because it only allows using the bridge from ArcGIS, not from within R itself. ArcGIS Pro is 64-bit and allows you to use use 64-bit R with <code>arcgisbinding</code>.</p>
<p>The <a href="https://github.com/R-ArcGIS/r-bridge/blob/master/README.md">README.md in the r-bridge GitHub repository</a> is the best starting point for more detail on R-ArcGIS Bridge requirements and installation.</p>
<p>The R-ArcGIS Bridge cannot write spatial data directly to the Council’s Portal and AGOL. It can write to a local geodatabase, which can then be published to Portal or AGOL via ArcGIS Pro. The R-ArcGIS Bridge can read spatial data directly from the Council’s Portal and AGOL:</p>
<script src="https://gist.github.com/laurie-platt/30c253e3b5ddf37ea13446d027ae7d41.js"></script><p>The <code>arc.check_product()</code> to define a desktop license means that the results of the example above can’t be rendered via GitHub Actions in these notes. However, the same example has been knitted locally and included in some <a href="https://scc-pi.github.io/isochrones/isochrones.html#Secondary_schools">notes on isochrones</a>.</p>
</div>
</div>
<div id="leaflet" class="section level2">
<h2>
<span class="header-section-number">17.4</span> Leaflet<a class="anchor" aria-label="anchor" href="#leaflet"><i class="fas fa-link"></i></a>
</h2>
<p><em>TODO</em></p>
</div>
<div id="rasters" class="section level2">
<h2>
<span class="header-section-number">17.5</span> Rasters<a class="anchor" aria-label="anchor" href="#rasters"><i class="fas fa-link"></i></a>
</h2>
<p><em>TODO</em></p>
</div>
<div id="further-resources-8" class="section level2">
<h2>
<span class="header-section-number">17.6</span> Further resources<a class="anchor" aria-label="anchor" href="#further-resources-8"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://geocompr.robinlovelace.net/">Geocomputation with R</a>, by Robin Lovelace</p>
<p><a href="https://onsgeo.github.io/geospatial-training/docs/intro_to_gis_in_r">Introduction to GIS in R</a>, 2-3hr course by ONS Geo (geography teams in ONS).</p>
<p><a href="https://r-spatial.github.io/mapview/articles/articles/mapview_01-basics.html">mapview basics</a> vignette</p>
<p><a href="https://www.esri.com/arcgis-blog/products/arcgis-pro/mapping/gcs_vs_pcs/">Geographic vs Projected Coordinate Systems</a>, Heather Smith, ArcGIS Blog (27 February 2020)</p>
<p><a href="https://lyzidiamond.com/posts/4326-vs-3857#:~:text=EPSG%3A3857%20(Pseudo%2DMercator),-The%20projected%20Pseudo&amp;text=This%20projection%20was%20first%20introduced,the%20coordinates%20onto%20a%20sphere.">EPSG 4326 vs EPSG 3857</a>, Lyzi Diamond (26 May 2017)</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="gis-with-python.html"><span class="header-section-number">16</span> GIS with Python</a></div>
<div class="next"><a href="geocoding.html"><span class="header-section-number">18</span> Postcodes &amp; addresses</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#gis-with-r"><span class="header-section-number">17</span> GIS with R</a></li>
<li>
<a class="nav-link" href="#features"><span class="header-section-number">17.1</span> Features</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#simple-features"><span class="header-section-number">17.1.1</span> Simple features</a></li></ul>
</li>
<li>
<a class="nav-link" href="#coordinates-projections"><span class="header-section-number">17.2</span> Coordinates &amp; projections</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#geographic-projected-coordinate-systems"><span class="header-section-number">17.2.1</span> Geographic &amp; projected coordinate systems</a></li></ul>
</li>
<li>
<a class="nav-link" href="#arcgisr"><span class="header-section-number">17.3</span> ArcGIS R &amp; Python packages</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#esri2sf"><span class="header-section-number">17.3.1</span> esri2sf</a></li>
<li><a class="nav-link" href="#r-arcgis-bridge"><span class="header-section-number">17.3.2</span> R-ArcGIS Bridge</a></li>
</ul>
</li>
<li><a class="nav-link" href="#leaflet"><span class="header-section-number">17.4</span> Leaflet</a></li>
<li><a class="nav-link" href="#rasters"><span class="header-section-number">17.5</span> Rasters</a></li>
<li><a class="nav-link" href="#further-resources-8"><span class="header-section-number">17.6</span> Further resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/scc-pi/notes/blob/master/17-gis-r.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/scc-pi/notes/edit/master/17-gis-r.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>pinsheff</strong>" was written by Laurie Platt. It was last built on 2023-03-20.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
