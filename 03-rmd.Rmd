# R Markdown {#rmd}

## R Markdown vs Markdown

Markdown is a markup language for creating formatted text using a plain-text editor. Its main aim is readability, for it to have simple, unobtrusive syntax and be readable as-is, unlike text formatted with a markup language such as RTF or HTML. So it's easy to read the raw markdown document as well as final rendered output.

GitHub has it's own flavour of markdown, most commonly used in the `README.md` file that serves to introduce each GitHub repository.

R Markdown is another flavour of markdown. It combines in a reproducible manner: code, output, and commentary. R Markdown documents support different output formats, like PDFs, Word files, slideshows, and HTML. Hadley Wickham [lists](https://r4ds.had.co.nz/r-markdown.html#introduction-18) the three main uses of R Markdown files as:

1.  For communicating to decision makers, who want to focus on the conclusions, not the code behind the analysis.

2.  For collaborating with other data scientists (including future you!), who are interested in both your conclusions, and how you reached them (i.e. the code).

3.  As an environment in which to *do* data science, as a modern day lab notebook where you can capture not only what you did, but also what you were thinking.

## Child markdown iteration

*TODO - GIST - example based on C19 UoS example - not a prominent technique because the demand for such reports has largely been superseded by browser based dashboards such as those provided via Power BI or Shiny.*

## Notebooks

*TODO - technical vs data exploration - don't add to github*

## Bookdown

These notes are written using the [bookdown package](https://pkgs.rstudio.com/bookdown/), which is built on top of R Markdown and [knitr](https://yihui.org/knitr/).

Each Rmd file contains one and only one chapter, and a chapter is defined by the first-level heading `#`.

### Themes

The theme of these notes changed in September 2021 from a [GitBook style](https://bookdown.org/yihui/bookdown/html.html#gitbook-style) to a [Three-column Bootstrap style](https://bookdown.org/yihui/bookdown/html.html#bs4-book).

### Publishing {#publishing}

These notes are published on [GitHub Pages](https://pages.github.com/) with [GitHub Actions](https://github.com/features/actions). A GitHub Action has been configured to start when there's a push to the [master branch](https://github.com/scc-pi/notes). The Action renders the Rmd files in the master branch to HTML and then deploys the HTML files as a static website to a branch called `gh-pages`. Alternatives to using GitHub Actions include Travis and Jekyll.

I used the steps outlined in the following blog post: [How to publish bookdown projects with GitHub Actions on GitHub Pages](https://medium.com/@delucmat/how-to-publish-bookdown-projects-with-github-actions-on-github-pages-6e6aecc7331e). However, I did a lot of the git bash commands manually and there were a couple of fixes I made to the `deploy_bookdown.yaml` file:

1\. Under ...

``` {.yaml}
uses: Cecilapp/GitHub-Pages-deploy@master
```

... I added ...

``` {.yaml}
with:       
  build_dir: _book/       
  email: ${{ secrets.EMAIL }}
```

2\. I used `GITHUB_TOKEN` rather than `GH_PAT`, as per a recent change to [GitHub-Pages-deploy](https://github.com/Cecilapp/GitHub-Pages-deploy#news).

## Flexdashboard

> The goal of flexdashboard is to make it easy to create interactive dashboards for R, using R Markdown.

[pkgs.rstudio.com/flexdashboard](https://pkgs.rstudio.com/flexdashboard/)

Flexdashboards don't have the same functionality of Power BI, nor do they allow data input like Shiny. However, they are very simple and quick to create. They can be a good option if the dashboard is unlikely to be maintained beyond a specific project, or, because the output is simply an HTML file, if you need to share the dashboard with one or two people outside the organisation. They're also obviously a good option if you've done your data analysis and preparatory work in R.

*TODO: Test whether a fexdashboard can be hosted via our Power BI Report Server in an IFrame.*

## Rolldown

> [Rolldown](https://github.com/yihui/rolldown/blob/master/README.md) is an R Markdown extension that builds scroll-driven HTML documents for storytelling, a.k.a scrollytelling.

It's similar to the ArcGIS StoryMaps that have proved popular and people might be familiar with.

## R Markdown tips

### Markdown visual editor

The RStudio v1.4 release includes a visual editor for markdown, which makes it more like using MS Word:

```{r echo=FALSE}
knitr::include_graphics("images/rmd-editor.png")
```

### Chunk named setup

Naming a code block `setup` means that after you restart RStudio and execute any code in the middle of your markdown document, the `setup` block will run first. For example, to make sure your libraries are loaded first:

```{r, include=FALSE}
# This will allow the chunk header below to be displayed in the output  
knitr::knit_hooks$set(wrapper = function(before, options) {
  # the original chunk might be indented
  if (is.null(indent <- options$indent)) indent <- ''
  
  # hide the wrapper=TRUE option
  opts <- gsub(', wrapper=TRUE', '', options$params.src)
  
  if (before) {
    # add the header
    sprintf('\n\n%s````\n```{r,%s}\n````', indent, opts)
  } else {
    # add the footer
    sprintf('\n%s````\n```\n````\n', indent)
  }
})
```

```{r, setup, message = FALSE, warning = FALSE, wrapper=TRUE}
# Packages
library(tidyverse)
```

## Further resources

[Chapter 27 R Markdown](https://r4ds.had.co.nz/r-markdown.html), R4DS by Hadley Wickham.

[Authoring Books and Technical Documents with R Markdown](https://bookdown.org/yihui/bookdown/) by Yihui Xie is the definitive resource for R Markdown.
