# R Markdown {#rmd}

## R Markdown vs Markdown

*TODO*

## Child markdown iteration

*TODO*

\- example based on C19 UoS example - not a prominent technique because the demand for such reports has largely been superseded by browser base dashboards such as those provided via Power BI or Shiny

## Notebooks

*TODO*

\- technical vs data exploration - don't add to github

## Bookdown

These notes are written using the [bookdown package](https://pkgs.rstudio.com/bookdown/), which is built on top of R Markdown and [knitr](https://yihui.org/knitr/).

Each Rmd file contains one and only one chapter, and a chapter is defined by the first-level heading `#`.

### Themes

The theme of these notes changed in September 2021 from a [GitBook style](https://bookdown.org/yihui/bookdown/html.html#gitbook-style) to a [Three-column Bootstrap style](https://bookdown.org/yihui/bookdown/html.html#bs4-book).

*TODO*\
[Theming](https://snowdreams1006.github.io/gitbook-official/en/themes/) [R4DS source](https://github.com/hadley/r4ds)

### Publishing {#publishing}

These notes are published on [GitHub Pages](https://pages.github.com/) with [GitHub Actions](https://github.com/features/actions). A GitHub Action has been configured to start when there's a push to the [master branch](https://github.com/scc-pi/notes). The Action renders the Rmd files in the master branch to HTML and then deploys the HTML files as a static website to a branch called `gh-pages`. Alternatives to using GitHub Actions include Travis and Jekyll.

I used the steps outlined in the following blog post: [How to publish bookdown projects with GitHub Actions on GitHub Pages](https://medium.com/@delucmat/how-to-publish-bookdown-projects-with-github-actions-on-github-pages-6e6aecc7331e). However, I did a lot of the git bash commands manually and there were a couple of fixes I made to the `deploy_bookdown.yaml` file:

1\. Under ...

``` {.yaml}
uses: Cecilapp/GitHub-Pages-deploy@master
```

... I added ...

``` {.yaml}
with:       
  build_dir: _book/       
  email: ${{ secrets.EMAIL }}
```

2\. I used `GITHUB_TOKEN` rather than `GH_PAT`, as per a recent change to [GitHub-Pages-deploy](https://github.com/Cecilapp/GitHub-Pages-deploy#news).

## Flexdashboard

> The goal of flexdashboard is to make it easy to create interactive dashboards for R, using R Markdown.

[pkgs.rstudio.com/flexdashboard](https://pkgs.rstudio.com/flexdashboard/)

Flexdashboards don't have the same functionality of Power BI, nor do they allow data input like Shiny. However, they are very simple and quick to create. They can be a good option if the dashboard is unlikely to be maintained beyond a specific project, or, because the output is simply an HTML file, if you need to share the dashboard with one or two people outside the organisation. They're also obviously a good option if you've done your data analysis and preparatory work in R.

*TODO: Test whether a fexdashboard can be hosted via our Power BI Report Server in an IFrame.*

## Further resources

[bookdown: Authoring Books and Technical Documents with R Markdown](https://bookdown.org/yihui/bookdown/) by Yihui Xie is the definitive resource for bookdown.

## R Markdown tips

### Markdown visual editor

The RStudio v1.4 release includes a visual editor for markdown, which makes it more like using MS Word:

![](images/rmd-editor.png "RStudio markdown visual editor")

### Chunk named setup

Naming a code block `setup` means that after you restart RStudio and execute any code in the middle of your markdown document, the `setup` block will run first. For example, to make sure your libraries are loaded first:

```{r, include=FALSE}
# This will allow the chunk header below to be displayed in the output  
knitr::knit_hooks$set(wrapper = function(before, options) {
  # the original chunk might be indented
  if (is.null(indent <- options$indent)) indent <- ''
  
  # hide the wrapper=TRUE option
  opts <- gsub(', wrapper=TRUE', '', options$params.src)
  
  if (before) {
    # add the header
    sprintf('\n\n%s````\n```{r,%s}\n````', indent, opts)
  } else {
    # add the footer
    sprintf('\n%s````\n```\n````\n', indent)
  }
})
```

```{r, setup, message = FALSE, warning = FALSE, wrapper=TRUE}
# Packages
library(tidyverse)
```
