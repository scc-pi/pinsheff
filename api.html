<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 12 APIs | pinsheff</title>
<meta name="author" content="Laurie Platt">
<meta name="description" content="12.1 REST APIs RESTful TODO - Foundation for Council services  12.2 Wrappers TODO  12.3 Rectangling Data returned from REST APIs are typically provided in a hierarchical structure and JSON is the...">
<meta name="generator" content="bookdown 0.33 with bs4_book()">
<meta property="og:title" content="Chapter 12 APIs | pinsheff">
<meta property="og:type" content="book">
<meta property="og:description" content="12.1 REST APIs RESTful TODO - Foundation for Council services  12.2 Wrappers TODO  12.3 Rectangling Data returned from REST APIs are typically provided in a hierarchical structure and JSON is the...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 12 APIs | pinsheff">
<meta name="twitter:description" content="12.1 REST APIs RESTful TODO - Foundation for Council services  12.2 Wrappers TODO  12.3 Rectangling Data returned from REST APIs are typically provided in a hierarchical structure and JSON is the...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.2/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script><link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="libs/HomeButton-0.0.1/home-button.js"></script><script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script><script src="libs/clipboard-0.0.1/setClipboardText.js"></script><link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">pinsheff</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About</a></li>
<li class="book-part">Power BI</li>
<li><a class="" href="power-bi-fundamentals.html"><span class="header-section-number">1</span> Power BI fundamentals</a></li>
<li><a class="" href="dax.html"><span class="header-section-number">2</span> DAX</a></li>
<li class="book-part">Scripting</li>
<li><a class="" href="why-script.html"><span class="header-section-number">3</span> Why script?</a></li>
<li><a class="" href="r.html"><span class="header-section-number">4</span> R &amp; RStudio</a></li>
<li><a class="" href="rmd.html"><span class="header-section-number">5</span> Markdown</a></li>
<li><a class="" href="python.html"><span class="header-section-number">6</span> Python</a></li>
<li><a class="" href="functions-packages.html"><span class="header-section-number">7</span> Functions &amp; packages</a></li>
<li><a class="" href="github.html"><span class="header-section-number">8</span> Version control &amp; GitHub</a></li>
<li><a class="" href="rap.html"><span class="header-section-number">9</span> RAP</a></li>
<li class="book-part">Accessing data</li>
<li><a class="" href="databases.html"><span class="header-section-number">10</span> Council data</a></li>
<li><a class="" href="warehouse.html"><span class="header-section-number">11</span> Databases, warehouses &amp; lakes</a></li>
<li><a class="active" href="api.html"><span class="header-section-number">12</span> APIs</a></li>
<li><a class="" href="public-data.html"><span class="header-section-number">13</span> External data sources</a></li>
<li class="book-part">Spatial data</li>
<li><a class="" href="spatial-data-sources.html"><span class="header-section-number">14</span> Spatial data sources</a></li>
<li><a class="" href="gis-with-web-desktop-tools.html"><span class="header-section-number">15</span> GIS with web &amp; desktop tools</a></li>
<li><a class="" href="gis-with-python.html"><span class="header-section-number">16</span> GIS with Python</a></li>
<li><a class="" href="gis-with-r.html"><span class="header-section-number">17</span> GIS with R</a></li>
<li><a class="" href="geocoding.html"><span class="header-section-number">18</span> Postcodes &amp; addresses</a></li>
<li class="book-part">ETL</li>
<li class="book-part">Statistical modelling</li>
<li class="book-part">Visualisation</li>
<li class="book-part">Appendix</li>
<li><a class="" href="other.html"><span class="header-section-number">19</span> Other</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/scc-pi/notes">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="api" class="section level1">
<h1>
<span class="header-section-number">12</span> APIs<a class="anchor" aria-label="anchor" href="#api"><i class="fas fa-link"></i></a>
</h1>
<div id="rest-apis" class="section level2">
<h2>
<span class="header-section-number">12.1</span> REST APIs<a class="anchor" aria-label="anchor" href="#rest-apis"><i class="fas fa-link"></i></a>
</h2>
<p>RESTful</p>
<p><em>TODO</em>
- Foundation for Council services</p>
</div>
<div id="wrappers" class="section level2">
<h2>
<span class="header-section-number">12.2</span> Wrappers<a class="anchor" aria-label="anchor" href="#wrappers"><i class="fas fa-link"></i></a>
</h2>
<p><em>TODO</em></p>
</div>
<div id="rectangling" class="section level2">
<h2>
<span class="header-section-number">12.3</span> Rectangling<a class="anchor" aria-label="anchor" href="#rectangling"><i class="fas fa-link"></i></a>
</h2>
<p>Data returned from REST APIs are typically provided in a hierarchical structure and JSON is the most common format. The tidyverse <a href="https://tidyr.tidyverse.org/articles/rectangle.html">Rectangling vignette</a> explains how to structure the data from the API into a more familiar tabular structure.</p>
<p><em>TODO</em><br>
scc-pi functions with rectangling e.g. postcode and geocoding</p>
</div>
<div id="api-via-council-proxy" class="section level2">
<h2>
<span class="header-section-number">12.4</span> API via Council proxy<a class="anchor" aria-label="anchor" href="#api-via-council-proxy"><i class="fas fa-link"></i></a>
</h2>
<p>When in Council buildings and connected directly to the Council’s network, rather than via AlwaysOn VPN, you may have difficulty accessing external API’s from RStudio (and installing packages and using GitHub). The following post from Posit outlines a method to resolve this: <a href="https://support.posit.co/hc/en-us/articles/200488488-Configuring-R-to-Use-an-HTTP-or-HTTPS-Proxy">Configuring R to Use an HTTP or HTTPS Proxy</a>.</p>
<p>In summary:</p>
<ol style="list-style-type: decimal">
<li><p>Run the command <code>file.edit('~/.Renviron')</code> within RStudio.</p></li>
<li><p>Add the following settings to your <code>.Renviron</code> file, amended for your own Council login ID and password.</p></li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="api.html#cb11-1"></a>http_proxy=http<span class="op">:</span><span class="er">//</span><span class="dv">172</span>.<span class="dv">29</span>.<span class="fl">2.22</span><span class="op">:</span><span class="dv">8080</span></span>
<span id="cb11-2"><a href="api.html#cb11-2"></a>http_proxy_user=lp41455<span class="op">:</span>password123</span>
<span id="cb11-3"><a href="api.html#cb11-3"></a></span>
<span id="cb11-4"><a href="api.html#cb11-4"></a>https_proxy=https<span class="op">:</span><span class="er">//</span><span class="dv">172</span>.<span class="dv">29</span>.<span class="fl">2.22</span><span class="op">:</span><span class="dv">8080</span></span>
<span id="cb11-5"><a href="api.html#cb11-5"></a>https_proxy_user=lp41455<span class="op">:</span>password123</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Uncheck the setting for <em>Use Internet Explorer library/proxy for HTTP</em> in <em>Global Options</em>:</li>
</ol>
<div class="inline-figure"><img src="images/proxy-ie.png" width="286"></div>
<ol start="4" style="list-style-type: decimal">
<li>Restart RStudio.</li>
</ol>
<p>When using AlwaysOn VPN comment out the settings:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># http_proxy=http://172.29.2.22:8080</span></span>
<span><span class="co"># http_proxy_user=lp41455:password123</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># https_proxy=https://172.29.2.22:8080</span></span>
<span><span class="co"># https_proxy_user=lp41455:password123</span></span></code></pre></div>
<p>These notes will be updated if we get to figuring out a setting that automatically toggles the proxy setting rather than you having to change this manually.</p>
<p>To test it’s working you could try the following:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#install.packages("httr2")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://httr2.r-lib.org">httr2</a></span><span class="op">)</span></span>
<span><span class="va">req</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://httr2.r-lib.org/reference/request.html">request</a></span><span class="op">(</span><span class="st">"https://data.police.uk/api/forces"</span><span class="op">)</span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html">req_perform</a></span><span class="op">(</span><span class="va">req</span><span class="op">)</span></span>
<span><span class="va">resp</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html">resp_body_html</a></span><span class="op">(</span>check_type <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code>## {html_document}
## &lt;html&gt;
## [1] &lt;body&gt;&lt;p&gt;[{"id":"avon-and-somerset","name":"Avon and Somerset Constabular ...</code></pre>
<p>Which should show you some content similar to what you see when you just use the same URL (<a href="https://data.police.uk/api/forces">https://data.police.uk/api/forces</a>) in a browser:</p>
<div class="inline-figure"><img src="images/api-browser-test.png" width="300"></div>
<p>These are the breadcrumbs for determining the proxy server and port:</p>
<ul>
<li><p>Windows settings</p></li>
<li><p>Proxy settings</p></li>
<li><p>Type the <em>script address</em> into Edge i.e. <a href="http://172.29.3.101/proxy.pac">http://172.29.3.101/proxy.pac</a></p></li>
<li><p>Open the downloaded <code>proxy.pac</code> file in a text editor</p></li>
<li><p>Try some of the proxy servers and ports listed in <code>proxy.pac</code></p></li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="warehouse.html"><span class="header-section-number">11</span> Databases, warehouses &amp; lakes</a></div>
<div class="next"><a href="public-data.html"><span class="header-section-number">13</span> External data sources</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#api"><span class="header-section-number">12</span> APIs</a></li>
<li><a class="nav-link" href="#rest-apis"><span class="header-section-number">12.1</span> REST APIs</a></li>
<li><a class="nav-link" href="#wrappers"><span class="header-section-number">12.2</span> Wrappers</a></li>
<li><a class="nav-link" href="#rectangling"><span class="header-section-number">12.3</span> Rectangling</a></li>
<li><a class="nav-link" href="#api-via-council-proxy"><span class="header-section-number">12.4</span> API via Council proxy</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/scc-pi/notes/blob/master/12-api.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/scc-pi/notes/edit/master/12-api.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>pinsheff</strong>" was written by Laurie Platt. It was last built on 2023-03-28.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
